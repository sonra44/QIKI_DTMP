# run_qiki_demo.sh

## Вход и цель
- [Факт] Демонстрационный скрипт запуска `Q-Sim Service` и `Q-Core Agent` в фоне.
- [Гипотеза] Используется для быстрого просмотра работы всей системы.

## Сбор контекста
- [Факт] Определяет пути к основным `main.py` сервисов【F:scripts/run_qiki_demo.sh†L10-L11】.
- [Факт] Создаёт директорию логов `.agent/logs/<date>` и сохраняет stdout каждого сервиса【F:scripts/run_qiki_demo.sh†L13-L23】【F:scripts/run_qiki_demo.sh†L26-L29】.
- [Факт] Запускает оба сервиса в фоне и выводит инструкцию по их остановке【F:scripts/run_qiki_demo.sh†L19-L34】.
- [Гипотеза] Не выполняет проверку зависимостей и health‑check.

## Локализация артефакта
- [Факт] Расположение: `scripts/run_qiki_demo.sh`.
- [Факт] Окружение: Unix‑подобное с Python3.

## Фактический разбор
1. [Факт] Настраивает пути и каталоги логов.
2. [Факт] Запускает симулятор, затем агента, сохраняя PID.
3. [Факт] Информирует пользователя о способе остановки.
4. [Гипотеза] Ожидает, что оба сервиса завершаются самостоятельно (`wait`).

## Роль в системе и связи
- [Факт] Демонстрирует взаимодействие сервиса симуляции и агента.
- [Гипотеза] Подходит для минимальных демонстраций, не для production.

## Несоответствия и риски
- [Гипотеза] Нет очистки логов и управления зависимостями (Med).
- [Гипотеза] Возможны «зависшие» процессы при ошибке одного из сервисов (High).

## Мини-патчи (safe-fix)
- [Патч] Добавить проверку, что процессы успешно стартовали.
- [Патч] Реализовать функцию `cleanup` и ловить `SIGINT`.

## Рефактор-скетч
```bash
#!/bin/bash
set -e
trap 'kill $Q_SIM_PID $Q_CORE_PID' INT
python3 services/q_sim_service/main.py & Q_SIM_PID=$!
python3 services/q_core_agent/main.py & Q_CORE_PID=$!
wait
```

## Примеры использования
```bash
bash scripts/run_qiki_demo.sh
```

## Тест-хуки/чек-лист
- [ ] Созданы лог‑файлы в `.agent/logs`.
- [ ] Сервисы корректно завершаются после `kill`.
- [ ] Нет неочищенных процессов.

## Вывод
- [Факт] Скрипт предоставляет быстрый способ запустить оба сервиса.
- [Патч] Требуется обработка ошибок и завершение процессов для устойчивости.
