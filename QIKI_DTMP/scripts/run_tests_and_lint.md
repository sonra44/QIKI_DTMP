# run_tests_and_lint.sh

## Вход и цель
- [Факт] Bash‑скрипт для запуска unit‑тестов, линтера и проверки `.proto` файлов.
- [Гипотеза] Используется локально разработчиком перед коммитом.

## Сбор контекста
- [Факт] Читает путь проекта и выставляет `PYTHONPATH`.
- [Факт] Выполняет `pytest` для `services/q_core_agent/tests/` и `ruff check` для каталога агента.
- [Факт] Проверяет синтаксис всех `.proto` файлов через `protoc`.
- [Гипотеза] Скрипт предполагает наличие `ruff`, `pytest` и `protoc` в `PATH`.

## Локализация артефакта
- [Факт] Расположение: `scripts/run_tests_and_lint.sh`.
- [Факт] Окружение: Unix‑подобная система с Python и инструментами разработки.

## Фактический разбор
1. [Факт] Настраивает переменные окружения для доступа к модулям.
2. [Факт] Запускает тесты и линтер последовательно, завершаясь при первой ошибке.
3. [Факт] Проверяет `.proto` файлы на синтаксис.
4. [Гипотеза] Не поддерживает выборочный запуск тестов.

## Роль в системе и связи
- [Факт] Служит частью локального QA‑цикла перед пушем.
- [Гипотеза] Может вызываться CI/CD пайплайном.

## Несоответствия и риски
- [Гипотеза] Отсутствует проверка наличия `pytest`, `ruff`, `protoc` (Med).
- [Гипотеза] Скрипт останавливается при первой ошибке без сводного отчёта (Low).

## Мини-патчи (safe-fix)
- [Патч] Добавить проверку установки `pytest`, `ruff` и `protoc` с понятными сообщениями.
- [Патч] Позволить передавать путь к тестам аргументом.

## Рефактор-скетч
```bash
#!/bin/bash
set -e
command -v pytest >/dev/null || { echo "pytest missing"; exit 1; }
pytest "${1:-services/q_core_agent/tests}" && ruff check services/q_core_agent
```

## Примеры использования
```bash
bash scripts/run_tests_and_lint.sh
bash scripts/run_tests_and_lint.sh services/other/tests
```

## Тест-хуки/чек-лист
- [ ] `pytest` завершился без ошибок.
- [ ] `ruff` не вывел предупреждений.
- [ ] `protoc` успешно прошёл по всем `.proto`.

## Вывод
- [Факт] Скрипт автоматизирует базовую проверку качества.
- [Патч] Стоит добавить проверки зависимостей и аргументы для гибкости.
