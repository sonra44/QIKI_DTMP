# start_sim.sh

## Вход и цель
- [Факт] Скрипт запускает `Q-Sim Service` как gRPC‑сервер.
- [Гипотеза] Используется для локальной симуляции перед запуском агента.

## Сбор контекста
- [Факт] Проверяет наличие Python и библиотеки `grpc`【F:scripts/start_sim.sh†L12-L22】.
- [Факт] Генерирует protobuf‑файлы при отсутствии `generated/q_sim_api_pb2.py`【F:scripts/start_sim.sh†L24-L32】.
- [Факт] Запускает `services/q_sim_service/grpc_server.py`【F:scripts/start_sim.sh†L34-L36】.

## Локализация артефакта
- [Факт] Расположение: `scripts/start_sim.sh`.
- [Факт] Окружение: Unix‑подобное, Python3, gRPC инструменты.

## Фактический разбор
1. [Факт] Определение корневого каталога проекта.
2. [Факт] Валидация окружения.
3. [Факт] Генерация `.pb2` при необходимости.
4. [Факт] Запуск gRPC сервера симуляции.
5. [Гипотеза] Нет проверки порта или повторного запуска.

## Роль в системе и связи
- [Факт] Предоставляет сервис симуляции, необходимый `Q-Core Agent`.
- [Гипотеза] Может быть расширен для docker‑compose.

## Несоответствия и риски
- [Гипотеза] Отсутствует health‑check после запуска (Med).
- [Гипотеза] Нет логирования ошибок (Low).

## Мини-патчи (safe-fix)
- [Патч] Добавить проверку занятости порта 50051 перед запуском.
- [Патч] Выводить путь к логам или перенаправлять stdout/stderr.

## Рефактор-скетч
```bash
#!/bin/bash
set -e
python3 services/q_sim_service/grpc_server.py "$@"
```

## Примеры использования
```bash
bash scripts/start_sim.sh
```

## Тест-хуки/чек-лист
- [ ] gRPC зависимости установлены.
- [ ] Сервер слушает порт 50051.
- [ ] Логи симуляции проверены на ошибки.

## Вывод
- [Факт] Скрипт обеспечивает быстрый запуск симулятора.
- [Патч] Стоит добавить проверки порта и логирование для диагностики.
