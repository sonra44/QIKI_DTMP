# Отчет: qiki_mission_control.py

## Вход и цель
- [Факт] Анализ исходного файла `qiki_mission_control.py`; итогом является подробный обзор и рекомендации.

## Сбор контекста
- [Факт] Изучены соседние модули: `ship_core`, `ship_actuators`, `test_ship_fsm`.
- [Гипотеза] Терминал предназначен для демонстрации автономного управления кораблём в консоли.

## Локализация артефакта
- [Факт] Путь: `QIKI_DTMP/services/q_core_agent/core/qiki_mission_control.py`.
- [Факт] Запуск: `python qiki_mission_control.py` в окружении Python 3.10+ без GUI-зависимостей.

## Фактический разбор
- [Факт] Класс `QIKIMissionControl` инициализирует `ShipCore`, `ShipActuatorController` и `ShipLogicController`.
- [Факт] Методы `_background_processes` и `_update_live_parameters` периодически обновляют телеметрию.
- [Факт] Лог хранит последние 100 записей и выдаёт метки времени миссии.
- [Гипотеза] Модуль ожидает, что все импорты доступны локально; зависимость от `test_ship_fsm` может быть нестабильной.

## Роль в системе и связи
- [Факт] Представляет интерактивный терминал Mission Control в ASCII-режиме.
- [Гипотеза] Используется разработчиками для тестирования логики корабля без графического интерфейса.

## Несоответствия и риски
- [Гипотеза][High] Нет механизма корректного завершения фонового потока при выходе.
- [Гипотеза][Med] Жёсткая привязка к локальным модулям (`test_ship_fsm`) усложняет повторное использование.

## Мини-патчи (safe-fix)
- [Патч] Добавить флаг остановки и `join()` для фонового потока при закрытии приложения.
- [Патч] Обернуть импорт `test_ship_fsm` в `try/except` и выдавать предупреждение.

## Рефактор-скетч (по желанию)
```python
class QIKIMissionControl:
    def __init__(self, core: ShipCore, actuators: ShipActuatorController):
        self.ship_core = core
        self.actuator_controller = actuators
        self.running = True
```

## Примеры использования
- [Факт]
```bash
python qiki_mission_control.py
```
- [Гипотеза]
```python
control = QIKIMissionControl()
control.autopilot_enabled = True
```

## Тест-хуки/чек-лист
- [Факт] Проверить обрезку лога до 100 записей.
- [Гипотеза] Протестировать переходы автопилота между состояниями FSM.

## Вывод
- [Факт] Модуль обеспечивает базовый ASCII-интерфейс для управления кораблём.
- [Патч] В ближайшее время стоит реализовать корректное завершение потоков и обработку отсутствующих зависимостей; рефакторинг структуры можно отложить.
