# Анализ `advanced_component.proto.template`

## Вход и цель
- [Факт] Шаблон Protobuf для расширенного компонента; цель — описать структуру и риски.

## Сбор контекста
- [Факт] Использует `google.protobuf` типы, `map`, `repeated`, сервисы с CRUD и поиском.
- [Гипотеза] Предназначен для генерации enterprise-сервисов на gRPC.

## Локализация артефакта
- [Факт] Путь: `tools/qiki_docgen/templates/advanced_component.proto.template`.
- [Факт] Окружение: protoc 3+, grpc tooling.

## Фактический разбор
- [Факт] Определяет основное сообщение, конфигурацию, здоровье, метрики и сервис с множеством RPC.
- [Факт] Включает фильтры, сортировку, перечисления `EntityStatus`, `HealthState`, `UpdateType`.

## Роль в системе и связи
- [Факт] Шаблон используется генератором для создания `.proto` контрактов новых компонентов.
- [Гипотеза] Служит основой для API и документации в README.

## Несоответствия и риски
- [Гипотеза][Med] Большой объём шаблона усложняет поддержку; изменение схемы требует синхронного обновления сервисов.
- [Гипотеза][Low] Отсутствие комментариев к некоторым полям может снижать читаемость.

## Мини-патчи (safe-fix)
- [Патч] Добавить комментарии к полям `Filter` и `SortOrder` для ясности.

## Рефактор-скетч
```proto
message {{ component_proto_type }} {
  qiki.common.UUID id = 1;
  // ...
}
```

## Примеры использования
```bash
# Генерация из шаблона
python -m tools.qiki_docgen.core.generator create_proto_contract MyComponent
```

## Тест-хуки/чек-лист
- [ ] Компиляция шаблона через `protoc` без ошибок.
- [ ] Проверка соответствия имён RPC ожидаемому `{{ component_name }}Service`.

## Вывод
- Шаблон задаёт полнофункциональный контракт с расширенными возможностями.
- Сразу добавить комментарии к вспомогательным типам.
- Отложить упрощение структуры для лёгких сервисов.
