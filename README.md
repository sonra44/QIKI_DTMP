# QIKI Digital Twin Microservices Platform (QIKI_DTMP)

**–í–µ—Ä—Å–∏—è: Production Ready (–æ–∫—Ç—è–±—Ä—å 2025)**

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–µ–∫—Ç–µ, –µ–≥–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–∏—Å—Ç–µ–º—ã.

## –û–ø–∏—Å–∞–Ω–∏–µ

QIKI_DTMP ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è, –º–æ–¥—É–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Å–∏–º—É–ª—è—Ü–∏–∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–¥–∞—Ä–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω (Radar v1) —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ NATS JetStream.

## Source of Truth / –ö–∞–Ω–æ–Ω—ã
- –®–∞–±–ª–æ–Ω—ã docgen: `tools/qiki_docgen/templates/*` (—Ñ–∞–π–ª—ã –≤ `roadmap/*.template` ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª–∏, –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å).
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `docs/analysis/*` (`analysis/*` ‚Äî –∑–∞–≥–ª—É—à–∫–∏).
- –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞: `CURRENT_STATE.md` –≤ –∫–æ—Ä–Ω–µ (–≤ `CONTEXT/` ‚Äî –∞—Ä—Ö–∏–≤).
- –ò–º–ø–æ—Ä—Ç—ã —Ä–∞–¥–∞—Ä–∞: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `qiki.radar.*`; `radar.*` ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–π shim, –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–∞–∂–æ—Ä–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

-   **`qiki-nats-phase1`**: –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π NATS —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º JetStream (–ø–æ—Ä—Ç—ã: 4222, 8222).
-   **`qiki-sim-phase1`**: –û—Å–Ω–æ–≤–Ω–æ–π gRPC —Å–µ—Ä–≤–∏—Å —Å–∏–º—É–ª—è—Ü–∏–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –¥–∞–Ω–Ω—ã–µ —Å–µ–Ω—Å–æ—Ä–æ–≤.
-   **`qiki-sim-radar-phase1`**: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–∞–¥–∞—Ä–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –ø—É–±–ª–∏–∫—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ NATS.
-   **`qiki-faststream-bridge-phase1`**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ FastStream, –∫–æ—Ç–æ—Ä–æ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–¥–∞—Ä–Ω—ã–µ –∫–∞–¥—Ä—ã –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç—Ä–µ–∫–∏.
-   **`qiki-dev-phase1`**: –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ Q-Core Agent.
-   **`qiki-nats-js-init`** (one-shot): –£—Ç–∏–ª–∏—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤ JetStream.
-   **`qiki-registrar-phase1`**: –°–µ—Ä–≤–∏—Å –∞—É–¥–∏—Ç–∞ —Å–æ–±—ã—Ç–∏–π.

### LR/SR —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–¥–∞—Ä–∞

- `q-sim-service` –ø—É–±–ª–∏–∫—É–µ—Ç —Ä–∞–¥–∞—Ä–Ω—ã–µ –∫–∞–¥—Ä—ã –≤ —Ç—Ä–∏ NATS-—Ç–æ–ø–∏–∫–∞: `qiki.radar.v1.frames.lr` (Long Range –±–µ–∑ ID/IFF), `qiki.radar.v1.tracks.sr` (Short Range —Å —Ç—Ä–∞–Ω—Å–ø–æ–Ω–¥–µ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏) –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π `qiki.radar.v1.frames`.
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç CloudEvents-—Ö–µ–¥–µ—Ä—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `x-range-band` (`RR_LR`, `RR_SR`, `RR_UNSPECIFIED`).
- –ü–æ—Ä–æ–≥ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `radar.sr_threshold_m` –≤ –∫–æ–Ω—Ñ–∏–≥–µ Q-Sim Service.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–∑ **–∫–æ—Ä–Ω—è git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è `QIKI_DTMP`**.

–ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∏—Å–∫ –ø–µ—Ä–µ–ø—É—Ç–∞—Ç—å –ø–∞–ø–∫—É/–∫–ª–æ–Ω, —Å–Ω–∞—á–∞–ª–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ:

```bash
# Bash
cd "$(git rev-parse --show-toplevel)"
```

```powershell
# PowerShell
Set-Location (git rev-parse --show-toplevel)
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Docker Desktop –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- Protobuf —Ñ–∞–π–ª—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø–∞–ø–∫–µ `generated/`
- Windows PowerShell –∏–ª–∏ Bash

### 1. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
docker compose up -d --build
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker compose ps
```

### 2.1 Operator Console (TUI) –ø–æ–≤–µ—Ä—Ö Phase1

Operator Console ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è TUI-–∫–æ–Ω—Å–æ–ª—å (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).

```bash
# –ó–∞–ø—É—Å–∫ (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ, –±–µ–∑ -d)
docker compose -f docker-compose.phase1.yml -f docker-compose.operator.yml up operator-console
```

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–≤ —Ñ–æ–Ω–µ) ‚Äî –ø–æ–¥–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ TUI:

```bash
docker compose -f docker-compose.phase1.yml -f docker-compose.operator.yml up -d operator-console
docker attach qiki-operator-console
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (Health Checks)

#### NATS Health Check

```bash
# –í Linux/WSL
curl -sf http://localhost:8222/healthz

# –í Windows PowerShell
Invoke-WebRequest -Uri http://localhost:8222/healthz -UseBasicParsing | Select-Object -ExpandProperty Content
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: `{"status":"ok"}`

#### gRPC Health Check (q-sim-service)

```bash
docker compose exec q-sim-service python -c "import grpc; from generated.q_sim_api_pb2_grpc import QSimAPIServiceStub; from generated.q_sim_api_pb2 import HealthCheckRequest; ch=grpc.insecure_channel('localhost:50051'); stub=QSimAPIServiceStub(ch); print(stub.HealthCheck(HealthCheckRequest(), timeout=3.0))"
```

### 4. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–∞–¥–∞—Ä–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞

–≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ—Ç —Ä–∞–¥–∞—Ä–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ NATS JetStream –∏ —á—Ç–æ LR/SR-—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

```bash
# NOTE: pytest.ini disables integration tests by default.
# Use the wrapper to run integration-marked tests.

./scripts/run_integration_tests_docker.sh tests/integration/test_radar_flow.py tests/integration/test_radar_tracks_flow.py

./scripts/run_integration_tests_docker.sh tests/integration/test_radar_lr_sr_topics.py
```

#### Smoke-—Ç–µ—Å—Ç—ã Stage 0

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã.

```bash
docker compose exec qiki-dev bash /workspace/scripts/smoke_test.sh
```

#### –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤

```bash
docker compose exec qiki-dev pytest -v tests/
```

### 5. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã

```bash
docker compose down
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### Protobuf —Ñ–∞–π–ª—ã
–ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π "ModuleNotFoundError: No module named 'generated'":

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å protobuf —Ñ–∞–π–ª—ã (–≤–Ω—É—Ç—Ä–∏ dev-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
docker compose -f docker-compose.phase1.yml run --rm qiki-dev bash -lc "bash tools/gen_protos.sh"
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker logs qiki-sim-phase1 -f
docker logs qiki-nats-phase1 --tail 50

# –°—Ç–∞—Ç—É—Å —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
```

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!** –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

## üìã **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ó–∞–¥–∞—á**

- **[–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –°–ø–∏—Å–æ–∫ –ó–∞–¥–∞—á](TASK_LIST.md)** - –µ–¥–∏–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- **[–î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –û–ø–∏—Å–∞–Ω–∏–µ](TASK_DETAILS.md)** - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
- **[–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã 2025](UPDATED_PRIORITIES_2025.md)** - —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è
