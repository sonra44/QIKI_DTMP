# План Модернизации Проекта QIKI_DTMP (Версия 2.0)

**Дата:** 2025-08-06
**Аналитик:** Агент СМИТ
**Статус:** **СКОРРЕКТИРОВАНО ПОСЛЕ КРИТИЧЕСКОГО АНАЛИЗА**

## 0. Важное примечание о версии 2.0

Этот план является исправленной версией первоначального документа. Первая версия содержала **фундаментальные ошибки**, основанные на устаревших данных, и не соответствовала `ANTI_FRAUD_DOCUMENTATION_PROTOCOL.md`. 

Данная версия учитывает все критические замечания, а выводы основаны на **практически верифицированных данных**.

---

## 1. Введение

**Главный вывод анализа (актуальный):** Проект обладает выдающимся архитектурным фундаментом и технически готов на 95%. Однако **главным и критическим блокером** для production-готовности является **полное отсутствие интеграционных и E2E тестов (0% покрытие)**. Именно на этом должен быть сфокусирован первый этап работы.

**Главный приоритет (скорректированный):** Создание надежной тестовой пирамиды (Integration -> E2E тесты).

## 2. Дорожная карта Модернизации

### Фаза 1: Укрепление Фундамента и Закрытие Долгов (1-2 недели)

**Цель:** Довести качество существующего кода и тестов до уровня, соответствующего высоким стандартам проекта.

| Задача | Описание | Приоритет | Статус в реальности |
|---|---|---|---|
| **T1.1 (АКТУАЛЬНО): Создание Integration-тестов** | Написать тесты, проверяющие взаимодействие между `Q-Core Agent` и `Q-Sim Service`. Проверить полный цикл "команда -> симуляция -> обратная связь". | **КРИТИЧЕСКИЙ** | **0% - отсутствуют** |
| **T1.2 (АКТУАЛЬНО): Улучшение качества Unit-тестов** | Переписать тесты, использующие "поверхностные" mock-объекты. Добавить проверки реального состояния системы после действий. Устранить оставшиеся проблемы (float precision). | **Высокий** | Качество ~60% |
| **T1.3 (АКТУАЛЬНО): Создание E2E Test Framework** | Создать end-to-end тесты, проверяющие полные пользовательские сценарии (например, запуск, выполнение миссии, штатное завершение). | **Высокий** | **0% - отсутствуют** |
| **T1.4 (АКТУАЛЬНО): Аудит документации** | Привести всю документацию в соответствие с `ANTI_FRAUD_DOCUMENTATION_PROTOCOL.md`. Проверить все утверждения и добавить команды для верификации. | **Средний** | Требуется |
| **~~T1.3: Полный рефакторинг логов~~** | ~~Заменить все оставшиеся `print()` на вызовы структурированного логгера. Настроить уровни логирования.~~ | **~~Средний~~** | **Уже сделано** |
| **~~T1.4: Устранение Mock-заглушек~~** | ~~Убрать "фальшивые" классы-заглушки из `ship_core.py` и тестовые данные из `main.py`.~~ | **~~Высокий~~** | **Задача некорректна** |

#### Пояснения к изменениям в Фазе 1:

*   **Вердикт по ~~T1.3 (Логи)~~: ЗАДАЧА НЕ АКТУАЛЬНА.**
    *   **Пояснение:** Анализ показал, что в коде сервисов уже нет вызовов `print()`. Логирование полностью внедрено с использованием `logger`.
    *   **Верификация:** `grep -r "print(" services/ --include="*.py" | wc -l` возвращает `0`.

*   **Вердикт по ~~T1.4 (Заглушки)~~: ЗАДАЧА НЕКОРРЕКТНА И ВРЕДНА.**
    *   **Пояснение:** Код в `ship_core.py` — это не заглушки, а корректные `dataclasses`. Тестовые данные в `main.py` являются необходимой частью функционала для запуска в `--mock` режиме. Их удаление сломает важный инструмент отладки.
    *   **Верификация:** `python services/q_core_agent/main.py --mock` успешно запускает систему в mock-режиме.

---

### Фаза 2: Создание Интерфейса (3-4 недели)

**Внимание:** Приоритет этой фазы **понижен**. Она может начаться только после завершения критических задач из Фазы 1 (особенно T1.1 и T1.3).

| Задача | Описание | Приоритет |
|---|---|---|
| **T2.1: Проектирование `Q-Operator Console`** | Создать детальный дизайн-документ, описывающий архитектуру, API и компоненты консоли. **Включить шаг валидации API.** | **Средний** |
| **T2.2: Реализация MVP CLI** | Создать базовый CLI-интерфейс для отправки команд агенту и получения его статуса. | **Средний** |
| **T2.3: Реализация TUI-дашборда** | Создать текстовый дашборд (с помощью `textual` или аналога) для визуализации ключевых метрик. | **Средний** |
| **T2.4: Интеграция с `Q-Core Agent`** | Подключить консоль к агенту через gRPC или другую шину сообщений. | **Средний** |

---

### Фаза 3: Расширение возможностей (непрерывно)

**Цель:** Развивать функционал системы в соответствии со стратегическим планом.

| Задача | Описание | Приоритет |
|---|---|---|
| **T3.1: Реализация `Event Store`** | Создать централизованное хранилище всех событий системы для отладки и анализа. | **Средний** |
| **T3.2: Развитие `Neural Engine`** | Заменить текущую заглушку на реальную модель машинного обучения для генерации "предложений". | **Низкий** |
| **T3.3: Расширение `Q-Sim Service`** | Добавить новые типы объектов, физические законы и сценарии в симулятор. | **Низкий** |

## 3. Ожидаемые результаты (Скорректированные)

*   **Повышение надежности:** **Создание полноценной тестовой пирамиды** даст реальную уверенность в стабильности системы.
*   **Завершение MVP:** Реализация `Q-Operator Console` позволит считать MVP проекта завершенным.
*   **Прозрачность и управляемость:** Новый интерфейс даст возможность наблюдать за работой агента и управлять им.
*   **Соответствие стандартам:** Документация будет полностью соответствовать высоким стандартам, заданным в проекте.

---
**План составлен:** Агент СМИТ