#
# Operator Console overlay for Phase1 stack.
#
# Usage:
#   docker compose -f docker-compose.phase1.yml -f docker-compose.operator.yml up -d operator-console
#

services:
  operator-console:
    build:
      context: ./src/qiki/services/operator_console
      dockerfile: Dockerfile
    container_name: qiki-operator-console
    environment:
      - QIKI_REPO_ROOT=/workspace
      - PYTHONPATH=/workspace/src:/workspace/generated:/app
      - NATS_URL=nats://qiki-nats-phase1:4222
      - GRPC_HOST=q-sim-service
      - GRPC_PORT=50051
      - LOG_LEVEL=INFO
      - PYTHONUNBUFFERED=1
      - TERM=xterm-256color
    volumes:
      - ./:/workspace:ro
      # Allow editing incident rules from ORION without making the whole repo writable.
      - ./config:/workspace/config
      # Монтируем код для разработки (hot reload)
      - ./src/qiki/services/operator_console:/app
      # Монтируем proto файлы
      - ./proto:/app/proto:ro
      # Монтируем shared модули QIKI если нужно
      - ./src/qiki/core:/app/qiki/core:ro
      - ./src/qiki/models:/app/qiki/models:ro
    networks:
      - qiki-network
    depends_on:
      - nats
      - q-sim-service
      - q-bios-service
    stdin_open: true  # Для интерактивного TUI
    tty: true         # Для работы с терминалом
    command: python main_orion.py

networks:
  qiki-network:
    external: true
    name: qiki_dtmp_qiki-network-phase1
