# Анализ файла: `protos/bios_status.proto`

**Версия документации:** 1.0  
**Дата анализа:** 2025-09-03

---

## 1. Назначение и Архитектурная Роль

Этот файл определяет формат сообщений для **отчетов о состоянии BIOS (Basic Input/Output System)**. Эти отчеты предоставляют комплексную проверку работоспособности аппаратных компонентов бота, аналогично процедуре Power-On Self-Test (POST) в реальных системах.

**Архитектурная роль:** `bios_status.proto` является ключевым для **мониторинга состояния оборудования** и **ранней диагностики проблем**. Он предоставляет стандартизированный способ для системы сообщать о здоровье своих аппаратных компонентов, что позволяет агенту принимать решения о своем операционном режиме (например, переходить в безопасный режим при критических сбоях).

---

## 2. Детальный Разбор Определений

### 2.1. Сообщение `DeviceStatus`

-   **`device_id`**: Уникальный идентификатор устройства (тип `qiki.common.UUID` из `common_types.proto`).
-   **`device_name`**: Человеко-читаемое имя устройства.
-   **`status` (enum)**: Операционный статус устройства:
    -   `OK`: Устройство работает нормально.
    -   `WARNING`: Устройство работает, но есть потенциальные проблемы.
    -   `ERROR`: Устройство неисправно.
    -   `NOT_FOUND`: Устройство не обнаружено.
-   **`error_message`**: Дополнительное текстовое сообщение об ошибке.
-   **`DeviceType` (enum)**: Тип устройства (например, `SENSOR`, `ACTUATOR`, `POWER_UNIT`, `CONTROLLER`).
-   **`StatusCode` (enum)**: Машиночитаемые коды ошибок, которые могут быть сопоставлены с beep-кодами или логами (например, `COMPONENT_NOT_FOUND`, `UNSTABLE_READINGS`, `CRITICAL_BOOT_FAILURE`).

### 2.2. Сообщение `BiosStatusReport`

-   **`timestamp`**: Временная метка, когда отчет был сгенерирован.
-   **`firmware_version`**: Версия прошивки BIOS.
-   **`post_results`**: Повторяющееся поле, содержащее список сообщений `DeviceStatus`, представляющих результаты проверки отдельных устройств.
-   **`all_systems_go`**: Булевый флаг, указывающий на общее состояние системы. `True`, если все критические системы работают нормально.
-   **`bios_uuid`**: Уникальный идентификатор экземпляра BIOS (тип `qiki.common.UUID`).
-   **`health_score`**: Общая оценка здоровья системы от 0.0 до 1.0.
-   **`last_checked`**: Временная метка последней проверки.
-   **`uptime_sec`**: Время работы системы в секундах.

---

## 3. Взаимодействие с Другими `.proto` Файлами и Модулями

-   **`protos/common_types.proto`**: Импортирует и использует `UUID`.
-   **`services/q_core_agent/core/bios_handler.py`**: Основной обработчик, который анализирует и использует `BiosStatusReport`.
-   **`services/q_core_agent/core/interfaces.py`**: Интерфейс `IDataProvider` определяет метод `get_bios_status()`, который возвращает `BiosStatusReport`.
-   **`services/q_core_agent/core/rule_engine.py`**: Использует флаг `all_systems_go` для активации правил безопасности (например, переход в безопасный режим).
-   **`generated/bios_status_pb2.py`**: Python-код, автоматически сгенерированный из этого `.proto` файла, используется в приложении для работы с отчетами BIOS.
