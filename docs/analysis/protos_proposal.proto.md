# Анализ файла: `protos/proposal.proto`

**Версия документации:** 1.0  
**Дата анализа:** 2025-09-03

---

## 1. Назначение и Архитектурная Роль

Этот файл определяет формат сообщений для **«Предложений» (Proposals)**. Предложение — это предлагаемое действие или набор действий, которые агент может выполнить, сопровождаемое метаданными, такими как уверенность, приоритет и обоснование.

**Архитектурная роль:** Сообщение `Proposal` является **основной структурой данных для процесса принятия решений агентом**. Оно спроектировано для поддержки гибридного ИИ (правила, нейронные сети) и позволяет строить сложные графы решений. Это критически важно для систем, где агенту необходимо не просто реагировать, но и планировать, учитывать зависимости и разрешать конфликты между потенциальными действиями.

---

## 2. Детальный Разбор Определений

### 2.1. Перечисления (Enums)

-   **`ProposalType`**: Категоризирует предложения по их назначению:
    -   `SAFETY`: Предложения, связанные с безопасностью (высший приоритет).
    -   `PLANNING`: Предложения по планированию действий.
    -   `DIAGNOSTICS`: Предложения по диагностике систем.
    -   `EXPLORATION`: Предложения по исследованию окружения.
-   **`ProposalStatus`**: Отслеживает жизненный цикл предложения:
    -   `PENDING`: Ожидает рассмотрения.
    -   `ACCEPTED`: Принято для исполнения.
    -   `REJECTED`: Отклонено.
    -   `EXECUTED`: Выполнено.
    -   `EXPIRED`: Истек срок действия.

### 2.2. Сообщение `Proposal`

-   **`proposal_id`**: Уникальный идентификатор предложения (тип `qiki.common.UUID` из `common_types.proto`).
-   **`source_module_id`**: Идентификатор модуля, который сгенерировал предложение (например, `rule_engine`, `neural_engine`).
-   **`timestamp`**: Временная метка создания предложения.
-   **`proposed_actions`**: Список сообщений `qiki.actuators.ActuatorCommand`, описывающих предлагаемые действия.
-   **`justification`**: Человеко-читаемое обоснование предложения. Критично для отладки и аудита решений ИИ.
-   **`priority`**: Приоритет предложения (от 0.0 до 1.0).
-   **`confidence`**: Степень уверенности в предложении (от 0.0 до 1.0), обычно генерируется AI-движком.
-   **`expected_duration`**: Ожидаемая продолжительность выполнения предложения (тип `google.protobuf.Duration`).
-   **`type`**: Тип предложения (`ProposalType`).
-   **`metadata`**: Карта `string` к `string` для хранения дополнительных, неструктурированных метаданных.
-   **`status`**: Текущий статус предложения (`ProposalStatus`).
-   **`depends_on`**: Список `UUID` других предложений, от которых зависит данное предложение. Позволяет строить графы зависимостей.
-   **`conflicts_with`**: Список `UUID` других предложений, с которыми данное предложение конфликтует. Позволяет разрешать конфликты в процессе принятия решений.
-   **`proposal_signature`**: Цифровая подпись предложения. Указывает на продвинутый подход к безопасности и целостности данных в автономных системах.

---

## 3. Взаимодействие с Другими `.proto` Файлами и Модулями

-   **`protos/common_types.proto`**: Импортирует и использует `UUID`.
-   **`protos/actuator_raw_out.proto`**: Импортирует и использует `ActuatorCommand` для описания предлагаемых действий.
-   **`services/q_core_agent/core/rule_engine.py`**: Генерирует сообщения `Proposal` на основе правил.
-   **`services/q_core_agent/core/neural_engine.py`**: Генерирует сообщения `Proposal` (в текущей реализации — заглушка).
-   **`services/q_core_agent/core/proposal_evaluator.py`**: Потребляет и оценивает сообщения `Proposal` для выбора лучшего решения.
-   **`services/q_core_agent/core/agent.py`**: Использует выбранные `Proposal` для принятия окончательных решений и отправки команд актуаторам.
-   **`generated/proposal_pb2.py`**: Python-код, автоматически сгенерированный из этого `.proto` файла, используется в приложении для работы с предложениями.
