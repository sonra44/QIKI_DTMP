# Анализ файла: `protos/q_sim_api.proto`

**Версия документации:** 1.0  
**Дата анализа:** 2025-09-03

---

## 1. Назначение и Архитектурная Роль

Этот файл определяет **gRPC-сервисный интерфейс (`QSimAPI`)** для `Q-Sim Service`. Он специфицирует удаленные вызовы процедур (RPC), которые клиенты (например, `Q-Core Agent`) могут использовать для взаимодействия с симулятором по сети.

**Архитектурная роль:** `q_sim_api.proto` является **формальным контрактом сервиса**. Он четко определяет, как внешние системы должны взаимодействовать с `Q-Sim Service` через gRPC. Это обеспечивает:
-   **Типобезопасность:** Все запросы и ответы строго типизированы, что предотвращает ошибки, связанные с несоответствием данных.
-   **Межсервисное взаимодействие:** Позволяет `Q-Core Agent` и `Q-Sim Service` работать как независимые, распределенные компоненты, потенциально на разных машинах или в разных контейнерах.
-   **Расширяемость:** Новые RPC-методы могут быть добавлены в этот сервис для расширения функциональности `Q-Sim Service` без нарушения работы существующих клиентов (благодаря обратной совместимости gRPC).

---

## 2. Детальный Разбор Определений

### 2.1. Сервис `QSimAPI`

-   **`GetSensorData(google.protobuf.Empty) returns (qiki.sensors.SensorReading)`**:
    -   **Назначение:** RPC для запроса последних данных сенсоров от симулятора.
    -   **Вход:** `google.protobuf.Empty` (не требует параметров).
    -   **Выход:** `qiki.sensors.SensorReading` (сообщение с данными сенсора).

-   **`SendActuatorCommand(qiki.actuators.ActuatorCommand) returns (google.protobuf.Empty)`**:
    -   **Назначение:** RPC для отправки команды исполнительному механизму в симулятор.
    -   **Вход:** `qiki.actuators.ActuatorCommand` (сообщение с командой актуатору).
    -   **Выход:** `google.protobuf.Empty` (не возвращает данных, только подтверждение).

-   **`HealthCheck(google.protobuf.Empty) returns (HealthResponse)`**:
    -   **Назначение:** RPC для проверки доступности и работоспособности сервиса.
    -   **Вход:** `google.protobuf.Empty`.
    -   **Выход:** `HealthResponse` (сообщение с информацией о состоянии здоровья).

### 2.2. Сообщение `HealthResponse`

-   **Назначение:** Используется в качестве ответа на RPC `HealthCheck`.
-   **Поля:**
    -   `status`: Строка, указывающая общий статус ("OK" или "ERROR").
    -   `message`: Дополнительная информация или детали о состоянии.
    -   `timestamp`: Временная метка ответа в Unix timestamp.

---

## 3. Взаимодействие с Другими `.proto` Файлами и Модулями

-   **`protos/sensor_raw_in.proto`**: Импортирует `SensorReading`.
-   **`protos/actuator_raw_out.proto`**: Импортирует `ActuatorCommand`.
-   **`google/protobuf/empty.proto`**: Импортирует стандартное пустое сообщение `Empty`.
-   **`services/q_sim_service/grpc_server.py`**: Реализует сервис `QSimAPI`, предоставляя конкретную логику для каждого RPC-метода.
-   **`services/q_core_agent/core/grpc_data_provider.py`**: Использует этот сервисный контракт для создания gRPC-клиента и выполнения удаленных вызовов к `Q-Sim Service`.
-   **`generated/q_sim_api_pb2_grpc.py`**: Python-код, автоматически сгенерированный из этого `.proto` файла, используется для создания gRPC-серверов и клиентов.
