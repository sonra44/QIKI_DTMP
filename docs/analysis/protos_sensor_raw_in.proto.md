# Анализ файла: `protos/sensor_raw_in.proto`

**Версия документации:** 1.0  
**Дата анализа:** 2025-09-03

---

## 1. Назначение и Архитектурная Роль

Этот файл определяет **универсальный формат сообщений для "сырых" показаний сенсоров** (`SensorReading`). Он спроектирован так, чтобы быть достаточно гибким для передачи данных от различных типов сенсоров (LIDAR, IMU, камера и т.д.) в стандартизированном виде.

**Архитектурная роль:** `sensor_raw_in.proto` обеспечивает **стандартизированный прием данных**. Наличие единой схемы для всех входящих сенсорных данных упрощает конвейеры обработки данных в `Q-Core Agent`. Использование `oneof` для основного поля данных является ключевым архитектурным решением, предотвращающим неоднозначность и обеспечивающим, что каждое показание сенсора содержит только один тип первичных данных (векторные, скалярные или бинарные).

---

## 2. Детальный Разбор Определений

### 2.1. Сообщение `SensorReading`

-   **`sensor_id`**: Уникальный идентификатор сенсора, который отправил данные (тип `qiki.common.UUID` из `common_types.proto`).
-   **`sensor_type`**: Стандартизированный тип сенсора (тип `qiki.common.SensorType` из `common_types.proto`).
-   **`timestamp`**: Временная метка, когда были сняты показания (тип `google.protobuf.Timestamp`).
-   **`oneof sensor_data`**: **Ключевая особенность.** Это поле-объединение гарантирует, что сообщение содержит только один из следующих типов данных:
    -   `vector_data`: Для сенсоров, возвращающих 3D-векторы (например, IMU, GPS) (тип `qiki.common.Vector3`).
    -   `scalar_data`: Для сенсоров, возвращающих одно числовое значение (например, температура, расстояние от LIDAR) (тип `float`).
    -   `binary_data`: Для сенсоров, возвращающих бинарные данные (например, изображения с камеры) (тип `bytes`).
-   **`unit`**: Единица измерения для скалярных данных (тип `qiki.common.Unit`).
-   **`is_valid`**: Флаг, указывающий на валидность данных. Критически важен для оценки качества данных.
-   **`encoding`**: Строка, указывающая кодировку бинарных данных (например, "jpeg", "png").
-   **`signal_strength`**: Показатель силы сигнала или качества показаний (от 0.0 до 1.0).
-   **`source_module`**: ID модуля-источника, который сгенерировал эти данные. Важен для трассировки и отладки.

---

## 3. Взаимодействие с Другими `.proto` Файлами и Модулями

-   **`protos/common_types.proto`**: Импортирует и использует `UUID`, `SensorType`, `Vector3` и `Unit`.
-   **`services/q_sim_service/main.py`**: Генерирует сообщения `SensorReading`.
-   **`services/q_core_agent/core/interfaces.py`**: Интерфейс `IDataProvider` определяет метод `get_sensor_data()`, который возвращает `SensorReading`.
-   **`generated/sensor_raw_in_pb2.py`**: Python-код, автоматически сгенерированный из этого `.proto` файла, используется в приложении для работы с сообщениями `SensorReading`.
