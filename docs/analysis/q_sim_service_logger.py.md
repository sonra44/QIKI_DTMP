# Анализ файла: `services/q_sim_service/logger.py`

**Версия документации:** 1.0  
**Дата анализа:** 2025-09-03

---

## 1. Назначение и Архитектурная Роль

Этот файл предоставляет **независимую систему логирования** специально для микросервиса `Q-Sim Service`. Его основная задача — обеспечить, чтобы симулятор имел свою собственную, автономную конфигурацию логирования, полностью отделенную от логирования `Q-Core Agent`.

**Архитектурная роль:** Реализация принципа **Разделения Ответственности (Separation of Concerns)** и **Декаплинга (Decoupling)**. Каждый микросервис должен быть максимально независимым. Наличие собственного модуля логирования предотвращает циклические зависимости и позволяет каждому сервису управлять своими журналами автономно, что критически важно для распределенных систем.

---

## 2. Детальный Разбор Функциональности

### 2.1. Функция `setup_logging()`

-   **Назначение:** Основная функция для настройки конфигурации логирования.
-   **Как работает:**
    -   **Загрузка конфигурации:** Пытается загрузить настройки логирования из YAML-файла. По умолчанию ищет `config.yaml` в той же директории, но путь может быть переопределен через переменную окружения (`env_key`, по умолчанию `LOG_CFG`).
    -   **Парсинг YAML:** Использует `yaml.safe_load()` для чтения конфигурации. Если в YAML-файле есть секция `logging`, она используется для настройки логгера через `logging.config.dictConfig()`.
    -   **Fallback:** Если указанный файл конфигурации не найден, или если в нем нет секции `logging`, или если произошла ошибка при загрузке, функция возвращается к базовой конфигурации логирования, выводя сообщения в консоль.
-   **Почему это важно:** Обеспечивает гибкость. Разработчики могут легко изменять уровень логирования, формат вывода или добавлять новые обработчики (например, для записи в файл) без изменения кода.

### 2.2. Экземпляр `logger`

-   **Как работает:** В конце файла создается и экспортируется экземпляр логгера с именем `"q_sim_service"` (`logging.getLogger("q_sim_service")`).
-   **Зачем это нужно:** Это позволяет всем модулям внутри `Q-Sim Service` использовать один и тот же, централизованно настроенный логгер, просто импортируя `logger` из этого файла.

---

## 3. Взаимодействие с Другими Модулями

-   **`services/q_sim_service/main.py`**: Вызывает `setup_logging()` при запуске и использует экспортированный `logger`.
-   **`services/q_sim_service/grpc_server.py`**: Также вызывает `setup_logging()` и использует `logger`.
-   **`services/q_sim_service/config.yaml`**: Является файлом конфигурации по умолчанию, из которого `setup_logging()` читает настройки.
