asyncapi: "2.6.0"
info:
  title: "QIKI Radar v1 (NATS)"
  version: "0.0.0"
  description: |
    Phase1 NATS subjects for Radar v1.

    On-wire payload encoding: JSON (UTF-8).

    Runtime sources of truth:
    - JSON models: `src/qiki/shared/models/radar.py` (`RadarFrameModel`, `RadarTrackModel`)
    - Publishers:
      - `src/qiki/services/q_sim_service/radar_publisher.py` (frames)
      - `src/qiki/services/faststream_bridge/track_publisher.py` (tracks)

    Reference contracts:
    - Protobuf: `protos/radar/v1/radar.proto` (field names align; no v2)
    - Contract evolution rules: `docs/CONTRACT_POLICY.md`

    Naming notes (plan aliases; backward-compatible input accepted by `RadarTrackModel`):
    - `iff_class` / `iffClass` maps to `iff`
    - `error_covariance` / `errorCovariance` maps to `position_covariance`

servers:
  nats:
    url: "nats://localhost:4222"
    protocol: "nats"
    description: "Local NATS broker (Phase1)."

channels:
  qiki.radar.v1.frames:
    description: "Radar frames (union topic). Payload: JSON `RadarFrameModel`."
    subscribe:
      message:
        $ref: "#/components/messages/RadarFrame"
  qiki.radar.v1.frames.lr:
    description: "Radar frames (Long Range). Payload: JSON `RadarFrameModel`."
    subscribe:
      message:
        $ref: "#/components/messages/RadarFrame"
  qiki.radar.v1.tracks.sr:
    description: "Short Range objects/frames (SR). Payload: JSON `RadarFrameModel`."
    subscribe:
      message:
        $ref: "#/components/messages/RadarFrame"
  qiki.radar.v1.tracks:
    description: "Aggregated radar tracks. Payload: JSON `RadarTrackModel`."
    subscribe:
      message:
        $ref: "#/components/messages/RadarTrack"

components:
  messages:
    RadarFrame:
      name: "RadarFrame"
      title: "RadarFrame"
      summary: "JSON payload for a radar frame (derived from `RadarFrameModel`)."
      payload:
        type: object
        description: "JSON payload (see `src/qiki/shared/models/radar.py`). Reference proto: `protos/radar/v1/radar.proto`."
    RadarTrack:
      name: "RadarTrack"
      title: "RadarTrack"
      summary: "JSON payload for an aggregated radar track (derived from `RadarTrackModel`)."
      payload:
        type: object
        description: "JSON payload (see `src/qiki/shared/models/radar.py`). Reference proto: `protos/radar/v1/radar.proto`."
