# PLAN — ORION unified UI design (Textual, tmux-first) — 2026-01-18

## Цель

Свести ORION к **единому, предсказуемому интерфейсу** (единая “сетка”, единые правила плотности, единая семантика цветов/статусов),
чтобы добавление новых виртуализируемых блоков (Power/Thermal/Propulsion/Comms/BIOS/…) не превращало консоль в “простыню”.

## Инварианты проекта (жёстко)

- Docker-first (Rule B): проверки/тесты/запуски в Docker.
- Serena-first: чтение/поиск/правки в репо через Serena.
- no-mocks: если сигнал не доказан — `N/A/—`.
- no `*_v2` и no-duplicates: не плодим параллельные каноны/контракты.
- NATS subjects: **не раздуваем** и не кодируем данные в subject (семантика в payload).

## Единые принципы ORION UI

### 1) Единая структура экрана (Chrome invariants)

Всегда одинаково:
1) Header (статус, 2 строки макс)
2) Workspace (контент активного экрана)
3) Bottom bar (Output + Command + Keybar)

Опционально (по плотности):
- Sidebar (слева)
- Inspector (справа)

### 2) Density-моды (tmux-first)

`wide` → `normal` → `narrow` → `tiny`

Деградация всегда в одном порядке:
1) Спрятать/сузить Inspector
2) Сузить/спрятать Sidebar
3) Переложить панели/таблицы (reflow)
4) Укоротить/компактизировать таблицы

### 3) Таблицы: единый паттерн “table → selection → inspector”

- “Основной взгляд” = компактная таблица (glanceable).
- Детали:
  - Inspector (по выделению),
  - или toggle “compact/details” (например, Enter).

### 4) Текст и аббревиатуры

- Везде `EN/RU` без пробелов вокруг `/`.
- Аббревиатуры разрешены только в dense-зонах (keybar/header/table headers), и должны быть раскрываемы через F9/Glossary/Inspector.
- На wide — показываем полные названия, на narrow/tiny — сокращаем.

### 5) Статусы/цвета

Единая семантика:
- `ok` → зелёный
- `warn` → жёлтый
- `crit` → красный
- `na` → dim/серый

### 6) Анти‑паттерн: “скачущий курсор” (таблица сама себя побеждает)

Запрещаем и отлавливаем:
- Нельзя на каждом refresh делать `move_cursor(row=0, ...)` или “поддерживать выделение” через принудительное дерганье курсора.
- Таблица должна уважать оператора: если он выделил строку — обновление данных **не должно** сбрасывать выделение.

Разрешённый паттерн:
- Храним selection по `row_key` (не по index).
- При перерисовке вычисляем `selected_row` (по `row_key`) и возвращаем курсор только если надо.
- Если `row_key` пропал — честно сбрасываем на первую строку.

### 7) Уплотнение без потери правды (минимум колонок, детали в Inspector)

Правило: в таблице держим только то, что реально нужно “с одного взгляда”.
- Если колонка почти всегда константа (например, `Source=telemetry`) — убираем из таблицы и показываем в Inspector.
- “Details view” не должен превращаться в простыню: если метрик становится много, вводим:
  - компактный режим по умолчанию (subsystem rows),
  - детализацию по toggle (Enter) и через Inspector.

### 8) Производительность (Textual / DataTable)

Когда строк/метрик станет много, `clear()+add_row()` на каждом тике начнёт:
- создавать лишнюю “пульсацию”/flicker,
- биться с выделением,
- грузить CPU.

Тогда переходим на следующий уровень:
- использовать `row_key` как стабильный ID строки;
- обновлять значения через `update_cell`/точечные апдейты вместо полного пересоздания таблицы;
- снижать частоту refresh до “операторской” (200–500ms) и/или делать throttle при отсутствии изменений.

## Конкретные задачи (по порядку, короткими итерациями)

1) Унифицировать подписи экранов (wide=полные, narrow=короткие)
   - keybar + sidebar + help glossary (если добавляем новые сокращения).

2) Унифицировать таблицы на “растущих” экранах
   - Sensors (уже: compact по умолчанию + toggle)
   - Далее: Power/Thermal/Propulsion — такой же подход, когда начнут разрастаться.

3) Полировка читабельности в tmux
   - фиксированные пресеты ширин колонок для всех таблиц (уже частично есть),
   - скрытие слишком плотных визуализаций на narrow (пример: Radar PPI).

4) Валидация по чеклисту ORION
   - `docs/design/operator_console/ORION_OS_VALIDATION_CHECKLIST.md`
   - зафиксировать ✅/❌ для ввод/resize/hotkeys/overflow.

## Done today (для ориентира)

- `adee833`: tmux-friendly widths + bigger previews/output; скрытие Radar PPI на narrow.
- `6e6c860`: Sensors compact по умолчанию + Enter toggle, чтобы убрать “простыню”.
