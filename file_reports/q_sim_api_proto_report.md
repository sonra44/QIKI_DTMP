# Отчет по файлу `protos/q_sim_api.proto`

## Вход и цель
- [Факт] Требуется анализ протокольного файла `q_sim_api.proto` и формирование отчета по структуре и задачам.

## Сбор контекста
- [Факт] Файл импортирует `sensor_raw_in.proto`, `actuator_raw_out.proto` и `google/protobuf/empty.proto` для обмена сообщениями.
- [Гипотеза] Предполагается наличие соответствующих файлов в каталоге `protos`, а также сервисов, использующих эти сообщения.

## Локализация артефакта
- [Факт] Путь: `protos/q_sim_api.proto` в корне проекта.
- [Факт] Используется синтаксис `proto3` и интерфейсы gRPC.

## Фактический разбор
- [Факт] Определен пакет `qiki.api`.
- [Факт] Сервис `QSimAPI` содержит RPC `GetSensorData`, `SendActuatorCommand` и `HealthCheck`.
- [Факт] Сообщение `HealthResponse` включает поля `status`, `message` и `timestamp`.

## Роль в системе и связи
- [Факт] Сервис обеспечивает обмен данными между агентом Q-Core и симулятором Q-Sim.
- [Гипотеза] Предполагается, что `GetSensorData` вызывается периодически, а команды актуатора отправляются по событиям.

## Несоответствия и риски
- [Гипотеза] Отсутствуют коды ошибок и статусы gRPC для обработки исключительных ситуаций — приоритет High.
- [Гипотеза] Отсутствует потоковый режим передачи для сенсоров, что может ограничивать производительность — приоритет Medium.
- [Гипотеза] Поле `timestamp` не уточняет единицы времени — приоритет Low.

## Мини-патчи (safe-fix)
- [Патч] Добавить комментарий о единицах измерения `timestamp` и возможных значениях `status`.
- [Патч] Уточнить, что при ошибке RPC возвращает соответствующий gRPC status.

## Рефактор-скетч (по желанию)
```proto
service QSimAPI {
  rpc GetSensorData(google.protobuf.Empty) returns (stream qiki.sensors.SensorReading); // поток данных
  rpc SendActuatorCommand(qiki.actuators.ActuatorCommand) returns (google.protobuf.Empty);
  rpc HealthCheck(google.protobuf.Empty) returns (HealthResponse);
}
```

## Примеры использования
- [Факт] Проверка состояния сервиса: `grpcurl -plaintext localhost:50051 qiki.api.QSimAPI/HealthCheck`.
- [Гипотеза] Получение данных сенсора в Python с использованием сгенерированного клиента gRPC.

## Тест-хуки/чек-лист
- [Факт] Интеграционный тест: вызов каждого RPC и проверка корректных ответов и статусов.
- [Гипотеза] Нагрузочный тест для оценки необходимости потоковой передачи.

## Вывод
- [Факт] Файл описывает базовый gRPC API между компонентами системы.
- [Гипотеза] Для повышения надежности требуется расширить обработку ошибок и документировать метаданные.
