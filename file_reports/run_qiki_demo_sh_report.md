# Отчет по файлу `scripts/run_qiki_demo.sh`

## Вход и цель
- [Факт] Проанализировать скрипт запуска демонстрации QIKI, описать его поведение и риски.

## Сбор контекста
- [Факт] Скрипт стартует два Python-сервиса: `q_sim_service` и `q_core_agent`.
- [Гипотеза] Оба сервиса находятся в каталоге `services` и имеют точку входа `main.py`.

## Локализация артефакта
- [Факт] Путь: `scripts/run_qiki_demo.sh`.
- [Факт] Требуется `bash` и установленный `python3`.

## Фактический разбор
- [Факт] Используются переменные `Q_SIM_SERVICE_PATH` и `Q_CORE_AGENT_PATH` для вычисления путей до сервисов.
- [Факт] Логи сохраняются в `.agent/logs/<date>`.
- [Факт] Скрипт запускает оба сервиса в фоне и ожидает их завершения через `wait`.

## Роль в системе и связи
- [Факт] Предоставляет удобный способ запустить демо-окружение QIKI.
- [Гипотеза] Используется разработчиками для локального тестирования взаимодействия сервисов.

## Несоответствия и риски
- [Гипотеза] Отсутствует обработка случаев, когда один из сервисов не стартует — приоритет High.
- [Гипотеза] Фиксированная задержка `sleep 2` может быть недостаточной — приоритет Medium.
- [Гипотеза] Логи не ротуются и могут накапливаться — приоритет Low.

## Мини-патчи (safe-fix)
- [Патч] Проверять наличие файлов `main.py` до запуска.
- [Патч] Добавить проверку успешного старта процессов и вывод ошибки при сбое.

## Рефактор-скетч (по желанию)
```bash
set -e
python3 "$Q_SIM_SERVICE_PATH" > "$Q_SIM_LOG" 2>&1 &
Q_SIM_PID=$!
if ! kill -0 $Q_SIM_PID 2>/dev/null; then
  echo "Q-Sim failed" >&2; exit 1;
fi
```

## Примеры использования
- [Факт] Запуск демо: `scripts/run_qiki_demo.sh`.
- [Гипотеза] Остановка сервисов: `kill $Q_SIM_PID $Q_CORE_PID`.

## Тест-хуки/чек-лист
- [Гипотеза] Интеграционный тест: скрипт запускается и оба сервиса доступны по gRPC.
- [Гипотеза] Проверка создания лог-файлов и корректного завершения при ошибках.

## Вывод
- [Факт] Скрипт автоматически поднимает два связанных сервиса.
- [Гипотеза] Необходимы проверки ошибок и более гибкое управление временем запуска.
