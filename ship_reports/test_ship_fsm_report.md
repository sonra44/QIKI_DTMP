# Отчет: `services/q_core_agent/core/test_ship_fsm.py`

## Вход и цель
- [Факт] Рассмотреть тест логики FSM корабля и предложить улучшения.

## Сбор контекста
- [Факт] Прочитан скрипт `test_ship_fsm.py`.
- [Факт] Использует `ShipCore` и `ShipActuatorController` без protobuf.
- [Гипотеза] Предназначен для интерактивной симуляции.

## Локализация артефакта
- [Факт] Путь: `services/q_core_agent/core/test_ship_fsm.py`.
- [Факт] Запускается как исполняемый скрипт.

## Фактический разбор
- [Факт] Определяет `ShipLogicController` с методами проверки систем и `process_logic_cycle`.
- [Факт] Симулирует переходы между состояниями `SHIP_STARTUP`, `SHIP_IDLE`, `FLIGHT_*`, `EMERGENCY_STOP`, `SYSTEMS_ERROR`.
- [Факт] Выполняет до 8 циклов, выводя результаты и состояние.

## Роль в системе и связи
- [Факт] Проверяет взаимодействие логики FSM с актуаторами.
- [Гипотеза] Используется для отладки поведения без полноценного FSMHandler.

## Несоответствия и риски
- [Факт] Отсутствуют asserts, что делает автоматизацию невозможной (Med).
- [Гипотеза] Циклы могут завершиться ранним break, что скрывает ошибки (Low).

## Мини-патчи (safe-fix)
- [Патч] Добавить assertions на ожидаемые переходы.
- [Патч] Вынести симуляции в отдельные функции для unit-тестов.

## Рефактор-скетч
```python
result = controller.process_logic_cycle()
assert result['current_state'] == expected
```

## Примеры использования
```bash
python services/q_core_agent/core/test_ship_fsm.py
```

## Тест-хуки/чек-лист
- [Факт] Проверить переход в EMERGENCY_STOP при `systems_ok=False`.
- [Гипотеза] Имитация thrust>0 должна привести к FLIGHT_CRUISE.

## Вывод
- [Факт] Скрипт демонстрирует работу FSM, но не интегрирован с pytest.
- [Патч] Добавить проверяемые утверждения и разделить логику для автоматических тестов.
